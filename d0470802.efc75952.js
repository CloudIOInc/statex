(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{167:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return j})),r.d(t,"metadata",(function(){return w})),r.d(t,"rightToc",(function(){return E})),r.d(t,"default",(function(){return C}));var n=r(2),a=r(9),o=r(0),i=r.n(o),s=r(169),u=r(174),l=(r(56),r(18),{display:"flex"}),c={display:"flex",flexDirection:"column",padding:20,whiteSpace:"nowrap"},d={flex:1,padding:20},f=[{key:"Lorem"},{key:"Mauris"},{key:"Nam"},{key:"Curabitur"}],h={Lorem:[{key:"Lorem",desc:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent egestas iaculis nibh, vel vestibulum augue. Nunc imperdiet, tortor et accumsan egestas, nisl mi porta mi, bibendum congue libero orci sit amet orci. Ut pharetra at urna a accumsan. Nulla leo felis, tristique eget metus maximus, rhoncus ornare ante. Donec mi est, aliquet pretium placerat id, dignissim in erat. Suspendisse convallis a mauris id tincidunt. Curabitur et mattis arcu, ac sodales massa. Praesent porttitor mauris eu nunc tempor, sit amet imperdiet lacus vulputate. Aliquam scelerisque risus eu elementum molestie. Aenean blandit euismod molestie."}],Mauris:[{key:"Mauris",desc:"Mauris ac sollicitudin odio. Integer nec viverra purus. Quisque eget sodales velit, et pulvinar enim. Pellentesque pulvinar faucibus lorem, at sagittis lectus suscipit ut. Phasellus tristique enim eu feugiat rutrum. Quisque sollicitudin eros erat, eget rhoncus arcu euismod in. Sed non enim nulla. Duis non sagittis lorem. Fusce at vulputate dui, at faucibus turpis. In vel cursus dolor, quis hendrerit urna. Proin non ultricies augue, semper placerat sem. Sed at metus quis nisl sodales consectetur in in dolor."}],Nam:[{key:"Nam",desc:"Nam convallis efficitur faucibus. Suspendisse molestie mauris vitae turpis vestibulum, vel finibus dolor tempus. Nullam non urna sed neque dignissim pulvinar. Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque pretium diam vitae mollis elementum. In vitae pretium sem, ut euismod enim. Fusce varius justo in massa viverra, ac pellentesque libero dignissim. Sed ullamcorper eleifend diam. Ut leo turpis, pharetra nec ipsum vitae, elementum dignissim sem. Donec eu lectus eget tellus pharetra vulputate. Vivamus non mi ac turpis accumsan egestas at iaculis lectus."}],Curabitur:[{key:"Curabitur",desc:"Curabitur efficitur laoreet libero non vulputate. Fusce ultricies sapien in ligula rhoncus accumsan. Nunc ac est blandit tellus convallis maximus nec quis risus. Mauris tincidunt sapien id lacinia mollis. Curabitur suscipit egestas ante at porta. Nam dui justo, lobortis a auctor et, viverra non nunc. Quisque cursus aliquet tortor eget finibus. Suspendisse potenti. Vestibulum neque augue, suscipit vitae augue ut, tristique imperdiet leo. Suspendisse ante mi, pharetra quis pretium facilisis, dignissim in neque. Donec vehicula sem nec leo rutrum tincidunt. Nulla facilisi."}]},p=Object(u.atom)({path:["data","activeMaster"],defaultValue:null}),m=Object(u.selector)({path:["data","master"],defaultValue:[],get:function(){return new Promise((function(e){setTimeout((function(){return e(f)}),1e3)}))}}),b=Object(u.selector)({path:["data","details",":key"],defaultValue:[],get:function(e){var t=e.params;return(null==t?void 0:t.key)?new Promise((function(e){setTimeout((function(){return e(h[t.key])}),1e3)})):[]}});function g(){var e;const t=Object(u.useStateXValue)(p),r=Object(u.useStateXValue)(b,{params:{key:null!==(e=null==t?void 0:t.key)&&void 0!==e?e:"DEFAULT"}});return t&&r?i.a.createElement(i.a.Fragment,null,t.key,r.map(e=>i.a.createElement("div",{key:e.key},e.desc))):i.a.createElement("div",null,"\u261c Click on a master link...")}function v(){const e=Object(u.useStateXValue)(m),[t,r]=Object(u.useStateX)(p);return i.a.createElement(i.a.Fragment,null,e.map(e=>i.a.createElement("div",{key:e.key},t===e?i.a.createElement(i.a.Fragment,null,"\u27a3 "):null,i.a.createElement("a",{href:"#/",onClick:()=>r(e)},e.key))))}function y(){return i.a.createElement("div",{style:l},i.a.createElement("div",{style:c},i.a.createElement(o.Suspense,{fallback:"Loading Master..."},i.a.createElement(v,null))),i.a.createElement("div",{style:d},i.a.createElement(o.Suspense,{fallback:"Loading Details..."},i.a.createElement(g,null))))}var S=r(24);function O(){return S.a.canUseDOM?i.a.createElement(u.StateXProvider,null,i.a.createElement(y,null)):null}var j={id:"master-detail",title:"Master Detail"},w={id:"examples/master-detail",title:"Master Detail",description:"In this example, both master & details are load using async selectors.",source:"@site/docs/examples/master-detail.md",permalink:"/statex/docs/examples/master-detail",editUrl:"https://github.com/CloudIOInc/statex/edit/master/website/docs/examples/master-detail.md",sidebar:"someSidebar",previous:{title:"Canvas",permalink:"/statex/docs/examples/canvas"},next:{title:"StateXProvider",permalink:"/statex/docs/api-reference/core/StateXProvider"}},E=[],N={rightToc:E};function C(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(s.b)("wrapper",Object(n.a)({},N,r,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"In this example, both master & details are load using async ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"../api-reference/core/selector"}),"selectors"),"."),Object(s.b)(O,{mdxType:"App"}),Object(s.b)("p",null,Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/CloudIOInc/statex/blob/master/website/src/components/master-details/App.tsx"}),"View this code on github")))}C.isMDXComponent=!0},169:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return p}));var n=r(0),a=r.n(n);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=a.a.createContext({}),c=function(e){var t=a.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},d=function(e){var t=c(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},h=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,l=u(e,["components","mdxType","originalType","parentName"]),d=c(r),h=n,p=d["".concat(i,".").concat(h)]||d[h]||f[h]||o;return r?a.a.createElement(p,s(s({ref:t},l),{},{components:r})):a.a.createElement(p,s({ref:t},l))}));function p(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=h;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var l=2;l<o;l++)i[l]=r[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,r)}h.displayName="MDXCreateElement"},174:function(e,t,r){e.exports=r(182)},182:function(e,t,r){"use strict";r.r(t),r.d(t,"Resolvable",(function(){return u})),r.d(t,"StateXProvider",(function(){return H})),r.d(t,"atom",(function(){return Q})),r.d(t,"hasSelector",(function(){return i})),r.d(t,"hasStateX",(function(){return o})),r.d(t,"isReactElement",(function(){return N})),r.d(t,"isResolvable",(function(){return l})),r.d(t,"isSelectorNode",(function(){return s})),r.d(t,"selector",(function(){return ce})),r.d(t,"useDebug",(function(){return pe})),r.d(t,"usePrintTree",(function(){return Ee})),r.d(t,"useRemoveStateX",(function(){return fe})),r.d(t,"useStateX",(function(){return ue})),r.d(t,"useStateXCallback",(function(){return te})),r.d(t,"useStateXForCheckbox",(function(){return we})),r.d(t,"useStateXForNumberInput",(function(){return Se})),r.d(t,"useStateXForSelect",(function(){return ye})),r.d(t,"useStateXForTextInput",(function(){return ve})),r.d(t,"useStateXForToggle",(function(){return je})),r.d(t,"useStateXGetter",(function(){return Z})),r.d(t,"useStateXRef",(function(){return be})),r.d(t,"useStateXRefValue",(function(){return ge})),r.d(t,"useStateXResolveable",(function(){return ie})),r.d(t,"useStateXSetter",(function(){return Y})),r.d(t,"useStateXValue",(function(){return ne})),r.d(t,"useStateXValueGetter",(function(){return ee})),r.d(t,"useStateXValueRemover",(function(){return de})),r.d(t,"useStateXValueResolveable",(function(){return oe})),r.d(t,"useStateXValueSetter",(function(){return re})),r.d(t,"useWithStateX",(function(){return he}));var n=r(0),a=r.n(n);function o(e){return void 0!==e.atom}function i(e){return void 0!==e.selector}function s(e){return void 0!==e.data.selector}class u{constructor(e,t){this.cancelled=!1,this.clone=()=>{const e=new u(this.selectorNode,this.self);return e.value=this.value,e.status=this.status,e.promise=this.promise,e.error=this.error,e.cancelled=this.cancelled,e},this.resolveIfSelf=e=>{switch(this.status){case"pending":throw this.promise;case"error":throw this.error;default:if(this.selectorNode===e&&this.self)return this.value;throw this.promise}},this.resolve=()=>{switch(this.status){case"pending":throw this.promise;case"error":throw this.error;default:return this.value}},this.selectorNode=e,this.status="pending",this.self=t}static withValue(e,t){const r=new u(e,!0);return r.value=t,r.status="resolved",r}}function l(e){return e instanceof u}class c{constructor(e){this.path=e.path,this.defaultValue=e.defaultValue,this.shouldComponentUpdate=e.shouldComponentUpdate,this.updater=e.updater,this.onChange=e.onChange}}function d(e){return null!==e&&Array.isArray(e)}function f(e){return e&&"object"==typeof e}function h(e){return null==e}function p(e){return Array.isArray(e)}let m=!0;function b(e){m=e}function g(e){return Array.isArray(e)?[...e]:Object.assign({},e)}function v(e,t,r){if(d(e)){if("number"==typeof t)return function(e,t,r){if(e[t]===r)return e;if(m&&!Object.isFrozen(e))return e[t]=r,e;if(t===e.length)return[...e,r];{const n=g(e);return n[t]=r,n}}(e,t,r(e.length>t?e[t]:null));throw Error(`Invalid key ${String(t)}. Must be of type number.`)}return f(e)?function(e,t,r){return e[t]===r?e:m&&!Object.isFrozen(e)?(e[t]=r,e):Object.assign(Object.assign({},e),{[t]:r})}(e,t,r(e[t])):e}function y(e,t,r){return v(e,t,()=>r)}function S(e,t){if(d(e)){if("number"==typeof t)return e.length>t?e[t]:void 0;throw Error(`Invalid key ${t}. Must be of type number.`)}return f(e)?e[t]:null}function O(e,t,r){const n=function e(t,r,n){if(0===r.length&&0===n)return t;const a=r[n];if(r.length===n+1)return S(t,a);const o=S(t,a);if(h(o))return null;if(!f(o))throw console.error(t,r,n),Error(`Invalid path ${JSON.stringify(r)} at index ${n}. Must be an object. Instead found ${o}`);return e(o,r,n+1)}(e,t,0);return h(n)?r:n}function j(e,t,r){return function(e,t,r){return function e(t,r,n,a,o){if(0===r.length&&0===n)return a(t);const i=r[n];if(r.length===n+1)try{if(o){if("number"==typeof i&&d(t))return function(e,t,r){if(d(e)){if(t<e.length){const n=e.slice(0,t),a=e.slice(t);return[...n,r(e[t]),...a]}if(t===e.length)return[...e,r(null)];throw Error(`Index out of bound! Index ${t}. Size ${e.length}.`)}throw Error("insert called on invalid collection. collection must be of type Array.")}(t,i,a);throw Error("insertIn called on invalid collection. \n          leaf collection must be of type Array \n          & leaf path must be a number.")}return v(t,i,a)}catch(t){throw Error(`${t.message} Path: ${JSON.stringify(r)}.`)}let s,u;try{s=S(t,i)}catch(t){throw Error(`${t.message} Path: ${JSON.stringify(r)} at index ${n}.`)}if(h(s))u="number"==typeof r[n+1]?[]:{};else{if(!f(s))throw Error(`Invalid path ${JSON.stringify(r)} at index ${n}. Must be an object.`);u=s}if(u=e(u,r,n+1,a,o),u===s)return t;try{return y(t,i,u)}catch(t){throw Error(`${t.message} Path: ${JSON.stringify(r)} at index ${n}.`)}}(e,t,0,r,!1)}(e,t,()=>r)}function w(e,t,r){const n=t[r];if(t.length===r+1)return function(e,t){if(function(e,t){if(d(e)){if("number"==typeof t)return e.hasOwnProperty(t);throw Error(`Invalid key ${t}. Must be of type number.`)}return!!f(e)&&e.hasOwnProperty(t)}(e,t)){if(d(e)){if("number"==typeof t)return[...e.slice(0,t),...e.slice(t+1)];throw Error(`Invalid key ${t}. Must be of type number.`)}const r=g(e);if(f(r))return delete r[t],r}return e}(e,n);const a=S(e,n);let o;return null==a?e:(o=function(e,t){if(null!==e&&(Array.isArray(e)||"object"==typeof e))return e;throw Error(t)}(a,`Invalid path ${JSON.stringify(t)} at index ${r}. Must be an object.`),o=w(o,t,r+1),o===a?e:y(e,n,o))}function E(e){return e instanceof Promise||"object"==typeof e&&"function"==typeof e.then}function N(e){switch(typeof e.$$typeof){case"symbol":case"number":return!0}return!1}let C=!1;function P(e){C=!e,b(e)}function V(){}const k=Object.freeze({});function x(e,t){if(!t||0===Object.keys(t).length)return e;const r=[...e];Object.entries(t).forEach(e=>{const t=r.indexOf(":"+e[0]);-1!==t&&(r[t]=e[1])});const n=r.filter(e=>"string"==typeof e&&-1!==e.indexOf(":"));if(n.length)throw Error(`Missing parameter values for ${n.join(", ")} in path ${JSON.stringify(r)}. Params passed ${JSON.stringify(t)}`);return r}function U(e,t,r,n=!0){if(0===t.path.length)return e.getState();const a=O(e.getState(),t.path,r);return void 0===a?r:a}function M(e,t){const r=U(e,t);return t.data.lastKnownValue!==r}function R(e,t){const r=t.filter(e=>"string"==typeof e&&-1!==e.indexOf(":"));if(r.length)throw Error(`Missing parameter values for ${r.join(", ")} in path ${JSON.stringify(t)}!`);return e.trie().getNode(t)}function A(e,t){return e.data.holders.add(t),t.holding=!0,()=>{t.holding=!1,e.data.holders.delete(t)}}function $(e,t,r,n){return function(e,t,r,n){var a;let o,i;if(e.activateNode(t,"update",r),s(t))i=t.data.selector.setValue(e,t,r,n);else{const n=U(e,t);if(o=function(e){return"function"!=typeof e}(r)?r:r(n),o===n)return n;if("function"==typeof(null===(a=t.data.atom)||void 0===a?void 0:a.updater)&&(e.beforeAtomUpdater(t),o=t.data.atom.updater({value:o,oldValue:n,get:T(e),set:_(e)}),e.afterAtomUpdater(t)),o===n)return n;i=o,e.updatingState(t),e.trackAndMutate(t,o),e.addToPending(t.path,"update")}return i}(e,t,r,n)}function X(e,t,r){t instanceof c&&r.data.atom!==t?(r.data.atom=t,r.data.defaultValue=t.defaultValue,void 0===O(e.getState(),r.path,void 0)&&e.trackAndMutate(r,t.defaultValue)):t instanceof q&&r.data.selector!==t&&(r.data.selector=t,s(r)&&(r.data.initialized=!1))}function I(e,t){let r;if(e instanceof c)r=e.path;else if(e instanceof q)r=e.pathWithParams;else{if(!Array.isArray(e))throw Error(`Invalid state ${JSON.stringify(e)}. Must be path or atom or selector.`);r=e}return x(r,t)}function T(e,t){return(r,n)=>{const a=I(r,null==n?void 0:n.params),o=R(e,a);return X(e,r,o),t&&t.add(R(e,a)),function(e,t,r){const n=function(e,t,r){var n;const{mutableRefObject:a}=r||k;return s(t)?t.data.selector.getValue(e,t,r):null!==(n=U(e,t,void 0,a))&&void 0!==n?n:t.data.defaultValue}(e,t,r);return l(n)?n.resolve():n}(e,o,n)}}function _(e){return(t,r,n)=>{const a=I(t,null==n?void 0:n.params),o=R(e,a);return X(e,t,o),$(e,o,r,n)}}function D(){throw Error("Not a writable selector!")}class q{constructor({path:e,get:t,set:r,shouldComponentUpdate:n,defaultValue:a}){this.dynamic=!1,this.params=new Map,this._evaluate=(e,t)=>{const{get:r,set:n,options:a}=t,o=R(e,x(this.pathWithParams,null==a?void 0:a.params));let i;e.activateNode(o,"read"),e.beforeSelectorGet(o);try{i=this._get({get:r,set:n,params:null==a?void 0:a.params})}catch(t){return this.makeResolvable(e,o,!1,t,null==a?void 0:a.params)}finally{e.afterSelectorGet(o)}return E(i)?this.makeResolvable(e,o,!0,i,null==a?void 0:a.params):(o.data.selectorValue=i,i)},this.getValue=(e,t,r)=>{var n;return t.data.initialized?t.data.resolveable?t.data.resolveable:t.data.selectorValue:(null===(n=t.data.previousNodes)||void 0===n||n.forEach(e=>{var r;null===(r=t.data.unregisterMap.get(e))||void 0===r||r()}),t.data.unregisterMap=new Map,t.data.previousNodes=new Set,t.data.initialized=!0,this.selectValueWithStateXHolder(e,r))},this.setValue=(e,t,r,n)=>{try{return e.beforeSelectorSet(t),this._set({set:_(e),get:T(e),params:null==n?void 0:n.params,value:r})}catch(t){throw e.catch(t),t}finally{e.afterSelectorSet(t)}},this.watchStateXForSelector=(e,t,r,n)=>{const a=t.data.unregisterMap.get(r);a&&(console.warn("Node already registered",t.path.join("."),r.path.join(".")),a());const o={setter:()=>{},node:t},i=A(r,o);o.setter=()=>this.update(e,t,n),t.data.unregisterMap.set(r,i)},this.update=(e,t,r)=>{const n=this.selectValueWithStateXHolder(e,r);if(l(n))try{t.data.holders.forEach(e=>e.setter(n))}catch(e){console.error(e)}else t.data.selectorValue=n,this.inform(e,n,t,!0)},this.selectValueWithStateXHolder=(e,t)=>{const r=x(this.pathWithParams,null==t?void 0:t.params),n=R(e,r),a=new Set,o=this._evaluate(e,{get:T(e,a),set:_(e),options:t});return a.forEach(r=>{n.data.previousNodes.has(r)?n.data.previousNodes.delete(r):this.watchStateXForSelector(e,n,r,t)}),n.data.previousNodes.forEach(e=>{var t;null===(t=n.data.unregisterMap.get(e))||void 0===t||t()}),n.data.previousNodes=a,o},this._get=t,this._set=null!=r?r:D,this.defaultValue=a,this.pathWithParams=e,this.shouldComponentUpdate=n;for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&":"===t.charAt(0)&&this.params.set(t.substr(1),o)}this.params.size&&(this.dynamic=!0)}makeResolvable(e,t,r,n,a){t.data.resolveable&&(t.data.resolveable.cancelled=!0);const o=new u(t,r);return E(n)?(o.promise=n,n.then(n=>(o.value=n,o.status="resolved",o.cancelled||(r?(t.data.resolveable=o.clone(),t.data.selectorValue=n,this.inform(e,n,t,r)):this.update(e,t,a)),n)).catch(e=>{if(o.error=e,o.status="error",!o.cancelled)try{t.data.resolveable=o.clone(),t.data.holders.forEach(e=>e.setter(t.data.resolveable))}catch(e){console.error(e)}})):(o.error=n,o.status="error"),t.data.resolveable=o,o}inform(e,t,r,n){const{oldValue:a}=r.data;r.data.oldValue=t;let o=!0;this.shouldComponentUpdate&&(e.beforeShouldComponentUpdate(r),o=this.shouldComponentUpdate(t,a),e.afterShouldComponentUpdate(r)),o&&r.data.holders.forEach(r=>{if(r.holding){let n=!0;r.shouldComponentUpdate&&(e.beforeShouldComponentUpdate(r.node),n=r.shouldComponentUpdate(t,a),e.afterShouldComponentUpdate(r.node)),n&&r.setter(t),r.onChange&&(e.beforeOnChange(r.node),r.onChange({value:t,oldValue:a,get:T(e),set:_(e)}),e.afterOnChange(r.node))}})}}class F{constructor(e){this._createNode=(e,t)=>({children:{},key:e,parent:t,path:t?[...t.path,e]:[],data:this.makeData(e,t)}),this._forEach=(e,t,r)=>{r(e,t),Object.values(e.children).forEach(e=>{this._forEach(e,t+1,r)})},this.forEach=(e,t)=>{const r=this.getNode(e);this._forEach(r,0,t)},this.getNode=(e,t=!0)=>{let r,n,a=this.root;for(let o=0;o<e.length;o++){if(n=e[o],r=a.children[n],!r){if(!t)throw Error(`Node not found at path ${e.join(".")}! Parent ${n} at index ${o} is missing!`);r=this._createNode(n,a),a.children[n]=r}a=r}return a},this.addNode=(e,t)=>{this.getNode(e).data=t},this.removeNode=e=>{var t;null===(t=e.parent)||void 0===t||delete t.children[e.key]},this._collectAllParentNodes=(e,t)=>{t.parent&&(e.push(t.parent),this._collectAllParentNodes(e,t.parent))},this.getAllParentNodes=e=>{const t=[];return this._collectAllParentNodes(t,this.getNode(e)),t},this._collectAllChildNodes=(e,t,r)=>{let n;for(const a in e.children)n=e.children[a],r&&!r(n)||(t.push(n),this._collectAllChildNodes(n,t,r))},this.getAllChildNodes=(e,t)=>{const r=[];return this._collectAllChildNodes(this.getNode(e),r,t),r},this.isRootNode=e=>e===this.root,this.makeData=e,this.root=this._createNode("_ROOT_")}}function z(){throw new Error("This component must be used inside a <StateXProvider> component.")}class J{constructor(e={},t=V){this._trie=new F(()=>({holders:new Set,defaultValue:void 0})),this.activeNodes=new Map,this.mutatedNodes=new Set,this.batching=!1,this.pending=[],this.updateSchedule=z,this.renderSchedule=z,this.postUpdateSchedule=z,this.postRenderSchedule=z,this.id=0,this.rendering=!1,this.registerPreUpdateScheduler=e=>{this.updateSchedule=e},this.registerPreRenderScheduler=e=>{this.renderSchedule=e},this.registerPostUpdateScheduler=e=>{this.postUpdateSchedule=e},this.registerPostRenderScheduler=e=>{this.postRenderSchedule=e},this.state=function e(t){if("object"==typeof t&&t.current)throw Error("Ref in deepFreeze!!!");if(!function(e){return!(!C||h(e)||"object"!=typeof e||(e.current?(console.warn("ref cannot be frozen"),1):Object.isFrozen(e)||e instanceof Element||e instanceof Event||function(e){var t,r;if("undefined"==typeof window)return!1;const n=null!==(r=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)&&void 0!==r?r:window;return"function"==typeof n.Node?e instanceof n.Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}(e)||N(e)||E(e)||e instanceof u&&(console.warn("Resolvable cannot be frozen"),1)))}(t))return t;const r=Object.getOwnPropertyNames(t);for(let n of r){let r=t[n];h(r)||"object"!=typeof r||e(r)}return Object.freeze(t)}(e),this.handleError=t}catch(e){this.handleError(e)}afterSelectorGet(e){}afterSelectorSet(e){}beforeSelectorGet(e){}beforeSelectorSet(e){}beforeShouldComponentUpdate(e){}afterShouldComponentUpdate(e){}beforeOnChange(e){}afterOnChange(e){}beforeAtomOnChange(e){}afterAtomOnChange(e){}beforeAtomUpdater(e){}afterAtomUpdater(e){}updatingState(e){}readingState(e){}removingState(e){}afterSelectorReads(){this.activeNodes.size&&this.activeNodes.clear(),this.lastLogItem=void 0,P(!0)}renderingStarted(){this.rendering=!0}renderingCompleted(){this.rendering=!1}afterStateUpdates(){this.activeNodes.size&&this.activeNodes.clear(),this.renderSchedule(),this.postRenderSchedule(),this.processTrackedMutates(),function(e){const t=function(e){const t=new Set;let r,n,a,o;return e.getPendingPaths().forEach(i=>{if(n=e.trie().getNode(i),!M(e,n))return;t.add(n),e.trie().getAllChildNodes(i,t=>M(e,t)).forEach(t.add,t);const s=e.trie().getAllParentNodes(i);for(r=s.length,o=0;o<r&&(a=s[o],!t.has(a));o++)t.add(a)}),t}(e);e.clearPending(),0!==t.size&&t.forEach(t=>{if(!s(t)){const r=U(e,t),{lastKnownValue:n,holders:a,atom:o}=t.data,i=l(n)&&"pending"===n.status;r!==n&&(t.data.lastKnownValue=r,(i||!(null==o?void 0:o.shouldComponentUpdate)||o.shouldComponentUpdate(r,n))&&a.forEach(t=>{if(t.holding){let a=!0;t.shouldComponentUpdate&&(e.beforeShouldComponentUpdate(t.node),a=t.shouldComponentUpdate(r,n),e.afterShouldComponentUpdate(t.node)),(i||a)&&t.setter(i||r),i||t.onChange&&(e.beforeOnChange(t.node),t.onChange({value:r,oldValue:n,get:T(e),set:_(e)}),e.afterOnChange(t.node))}}),(null==o?void 0:o.onChange)&&(e.beforeAtomOnChange(t),o.onChange({value:r,oldValue:n,get:T(e),set:_(e)}),e.afterAtomOnChange(t)))}})}(this)}debug(e,t,r){}activateNode(e,t,r){var n;let a=null!==(n=this.activeNodes.get(e))&&void 0!==n?n:0;if(a>10)throw Error(`Trying to ${t} $${e.path.join(".")} too many times!`);switch(this.activeNodes.set(e,++a),t){case"read":this.renderSchedule(),this.postRenderSchedule();break;default:if(this.updateSchedule(),this.postUpdateSchedule(),this.rendering){const r=`WARNING: Trying to ${t} $${e.path.join(".")} during render!`;this.debug(r,t)}}}addToPending(e,t){this.pending.push(e),this.updateSchedule(),this.postUpdateSchedule()}trie(){return this._trie}startBatch(){this.batching=!0}endBatch(){this.batching=!1}isBatching(){return this.batching}clearPending(){this.pending=[]}getPendingPaths(){return this.pending}getState(){return this.state}setState(e){this.state=e}trackAndMutate(e,t){e.parent&&this.mutatedNodes.add(e.parent),b(!0),this.setState(j(this.getState(),e.path,t)),b(!1)}trackAndRemove(e){e.parent&&this.mutatedNodes.add(e.parent),b(!0),this.setState(w(this.getState(),e.path,0)),b(!1)}processTrackedMutates(){b(!1),this.mutatedNodes.forEach(e=>{let t=O(this.getState(),e.path,void 0);t&&"object"==typeof t&&(t=Array.isArray(t)?[...t]:Object.assign({},t),this.setState(j(this.getState(),e.path,t)))}),this.mutatedNodes.clear()}}const L=Object(n.createContext)({current:new J});function W(){return Object(n.useContext)(L).current}function G(e){console.error("Unhandled Exception!"),console.error(e)}function K({registerPreUpdateScheduler:e,registerPreRenderScheduler:t}){const r=W();r.renderingStarted();const[a,o]=Object(n.useState)([]);e(()=>o([]));const[i,s]=Object(n.useState)([]);return t(()=>s([])),Object(n.useLayoutEffect)(()=>{r.renderingCompleted()},[i,r,a]),Object(n.useEffect)(()=>{r.afterStateUpdates()},[r,a]),Object(n.useEffect)(()=>{P(!1)},[]),null}function B({registerPostUpdateScheduler:e,registerPostRenderScheduler:t}){const r=W(),[,a]=Object(n.useState)([]);e(()=>a([]));const[o,i]=Object(n.useState)([]);return t(()=>i([])),Object(n.useLayoutEffect)(()=>{r.afterSelectorReads()},[o,r]),Object(n.useEffect)(()=>{P(!1)},[]),null}function H({initialState:e={},handleError:t=G,children:r}){const o=Object(n.useMemo)(()=>new J(e,t),[]),i=Object(n.useRef)(o);return a.a.createElement(L.Provider,{value:i},a.a.createElement(K,{registerPreUpdateScheduler:i.current.registerPreUpdateScheduler,registerPreRenderScheduler:i.current.registerPreRenderScheduler}),r,a.a.createElement(B,{registerPostUpdateScheduler:i.current.registerPostUpdateScheduler,registerPostRenderScheduler:i.current.registerPostRenderScheduler}))}function Q(e){return new c(e)}function Y(){const e=W();return Object(n.useMemo)(()=>_(e),[e])}function Z(){const e=W();return Object(n.useMemo)(()=>T(e),[e])}function ee(){return Z()}function te(e,t){const r=le(e),a=W();return Object(n.useCallback)((...e)=>r.current({get:T(a),set:_(a)},...e),[...t,r,a])}function re(e,t){const r=I(e,null==t?void 0:t.params),a=W(),o=R(a,r),i=le(t);return Object(n.useCallback)(e=>{try{return $(a,o,e,i.current)}catch(e){return void console.error(e)}},[a,o,i])}function ne(e,t,r){let n;if(e instanceof c)n=e.defaultValue,r=t;else if(e instanceof q)n=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom, selector or path.");void 0===t&&(t=null),n=t}return ae(e,n,r)}function ae(e,t,r){const n=I(e,null==r?void 0:r.params),a=R(W(),n);let o=se(a,e,t,r);return l(o)&&(o=o.resolveIfSelf(a)),o}function oe(e,t){const r=I(e,null==t?void 0:t.params),n=R(W(),r),a=se(n,e,e.defaultValue,t);return l(a)?a:u.withValue(n,a)}function ie(e,t){return[oe(e,t),re(e,t)]}function se(e,t,r,a){var o;const i=W();X(i,t,e),void 0===e.data.defaultValue&&(e.data.defaultValue=r);const u=Object(n.useRef)({setter:V,shouldComponentUpdate:null==a?void 0:a.shouldComponentUpdate,onChange:null==a?void 0:a.onChange,node:e}),[l,c]=Object(n.useState)(r);let d;d=t instanceof q?e!==u.current.node?r:l:null!==(o=U(i,e,void 0,!!(null==a?void 0:a.mutableRefObject)))&&void 0!==o?o:r;const f=Object(n.useRef)({defaultValue:r,options:a,currentValue:d}),[,h]=Object(n.useState)(d),p=Object(n.useCallback)(t=>{s(e)?c(t):h(t)},[c,h,e]);return Object(n.useEffect)(()=>{f.current.currentValue=d,f.current.defaultValue=r,f.current.options=a,u.current.shouldComponentUpdate=null==a?void 0:a.shouldComponentUpdate,u.current.onChange=null==a?void 0:a.onChange,u.current.setter=p,u.current.node=e},[d,r,a,e,p]),Object(n.useEffect)(()=>{const{defaultValue:t,options:r}=f.current;if(s(e)){const t=e.data.selector.getValue(i,e,r);c(t)}else{const n=U(i,e,void 0,!!(null==r?void 0:r.mutableRefObject));void 0===n?null!=t&&(p(t),e.data.selector||$(i,e,t,{mutableRefObject:!!(null==r?void 0:r.mutableRefObject)})):p(n)}},[e,p,i]),Object(n.useEffect)(()=>A(e,u.current),[e,u]),d}function ue(e,t,r){let n;if(e instanceof c)n=e.defaultValue,r=t;else if(e instanceof q)n=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom, selector or path.");void 0===t&&(t=null),n=t}return[ae(e,n,r),re(e,r)]}function le(e){const t=Object(n.useRef)(e);return Object(n.useLayoutEffect)(()=>{t.current=e},[e]),t}function ce(e){return new q(e)}function de(e,t){const r=I(e,null==t?void 0:t.params),a=W(),o=R(a,r),i=le(t);return Object(n.useCallback)(()=>function(e,t,r){return function(e,t){const r=e.trie().getNode(t);e.activateNode(r,"remove");const n=U(e,r);return r.data.lastKnownValue=n,e.removingState(r),e.trackAndRemove(r),r.parent&&e.addToPending(r.parent.path,"remove-child"),e.trie().removeNode(r),n}(e,x(t,null==r?void 0:r.params))}(a,o.path,i.current),[o,i,a])}function fe(e,t,r){let n;if(e instanceof c)n=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom, selector or path.");void 0===t&&(t=null),n=t}return[ae(e,n,r),de(e,r)]}function he(e){const t=W(),r=re([]),a=Object(n.useRef)(e),o=Object(n.useRef)(!0);return o.current&&(o.current=!1,t.setState(j(t.getState(),[],e))),Object(n.useEffect)(()=>{JSON.stringify(a.current)!==JSON.stringify(e)&&(r(e),a.current=e)},[r,e]),null}function pe(){const e=W();return Object(n.useCallback)((t,r,n)=>{e.debug(t,r,n)},[e])}function me(e,t){const r=re(e,t);return[Object(n.useCallback)(e=>r(e.target.value),[r]),r]}function be(e){const t=Object(n.useRef)(null),r=R(W(),e);return r.data.ref||(r.data.ref=t),Object(n.useEffect)(()=>()=>{r.data.ref=void 0},[r]),r.data.ref}function ge(e){return R(W(),e).data.ref}function ve(e,t,r){let n;if(e instanceof c)n=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom or path.");"string"!=typeof t&&(t=""),n=t}const a=ae(e,n,r),[o]=me(e,r);return{value:a,onChange:o,type:(null==r?void 0:r.type)||"text"}}function ye(e,t){const r=ne(e,t)||"",[n]=me(e,t);return{value:r,onChange:n}}function Se(e,t,r){let a;if(e instanceof c)a=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom or path.");"number"!=typeof t&&(t=0),a=t}const o=ae(e,a,r),[i]=function(e){const t=re(e);return[Object(n.useCallback)(e=>{const r=Number(e.target.value);Number.isNaN(r)||t(r)},[t]),t]}(e);return{value:o,onChange:i,type:"number"}}function Oe(e,t){const r=re(e,t);return[Object(n.useCallback)(()=>{r(e=>!e)},[r]),r]}function je(e,t,r){let n;if(e instanceof c)n=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom or path.");"boolean"!=typeof t&&(t=!1),n=t}const a=ae(e,n,r),[o]=Oe(e,r);return[!!a,o]}function we(e,t,r){let n;if(e instanceof c)n=e.defaultValue,r=t;else{if(!p(e))throw Error("Invalid atom type value! Must be either an atom or path.");"boolean"!=typeof t&&(t=!1),n=t}const a=ae(e,n,r),[o]=Oe(e,r);return{onChange:o,checked:!!a,type:"checkbox"}}function Ee(){const e=W();return t=>{const r=[];e.trie().forEach(t,(e,t)=>{r.push(`${"".padStart(2*t,"-")}${e.path.join(".")} ${e.data.holders.size}`),e.data.holders.forEach(e=>{r.push(`${"".padStart(2*t+2," ")}${e.node.path.join(".")}`)})}),console.log(r.join("\n"))}}}}]);